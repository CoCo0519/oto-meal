# 基于耳道PPG&IMU的行为分类系统 - 项目文件清单

## 📁 项目结构

```
Project-Swallow/
├── 🔧 原有项目文件
│   ├── anc_template_pipeline_100Hz.py      # 原有信号处理流水线
│   ├── ReadDirectory.py                    # 批处理脚本
│   ├── Readtxt.py                         # 单文件处理脚本
│   ├── Preprocess.m                       # MATLAB预处理
│   └── hyx_data/                          # 原始数据目录
│       ├── 耳道-*.txt                     # 耳道PPG&IMU数据
│       └── 喉咙-*.txt                     # 喉咙PPG&IMU数据
│
├── 🧠 新增深度学习系统
│   ├── behavior_classification_system.py  # 核心分类系统
│   ├── data_labeling_system.py           # 数据标注模块
│   ├── advanced_models.py                # 高级深度学习模型
│   ├── complete_training_pipeline.py     # 完整训练流水线
│   └── run_behavior_classification.py    # 一键运行脚本
│
├── 📋 配置和文档
│   ├── README_行为分类系统.md            # 系统使用说明
│   ├── config_example.json              # 配置文件示例
│   └── 项目文件清单.md                   # 本文件
│
└── 📊 运行时生成的结果文件
    ├── training_results_*/               # 训练结果目录
    ├── labeled_data_visualization/       # 标注可视化
    └── *.pth, *.png, *.csv等            # 模型和结果文件
```

## 🚀 核心文件详解

### 1. behavior_classification_system.py
**功能**: 核心行为分类系统
- ✅ 特征提取器 (STFT + MFCC)
- ✅ 数据预处理和窗口分割
- ✅ 基础CNN ResNet模型
- ✅ 训练和评估流程
- ✅ 结果可视化

**关键类**:
- `FeatureExtractor`: STFT和MFCC特征提取
- `BehaviorDataset`: PyTorch数据集
- `BehaviorCNN`: 基础CNN模型
- `BehaviorClassifier`: 主分类器

### 2. data_labeling_system.py
**功能**: 基于喉咙信号自动标注耳道数据
- ✅ 行为检测器 (咳嗽/吞咽/咀嚼)
- ✅ 特征提取和阈值检测
- ✅ 时间对齐和标签传播
- ✅ 检测结果可视化

**关键类**:
- `BehaviorDetector`: 基于喉咙信号的行为检测
- `DataLabeler`: 数据标注和管理
- 特化检测方法: `_detect_cough_events`, `_detect_swallow_events`, `_detect_chew_events`

### 3. advanced_models.py
**功能**: 高级深度学习模型库
- ✅ 改进的CNN ResNet (注意力机制)
- ✅ Transformer时间序列模型
- ✅ 多模态融合模型
- ✅ 自定义损失函数

**关键类**:
- `BehaviorTransformer`: 基于注意力的时间序列模型
- `AdvancedBehaviorCNN`: 改进的CNN架构
- `MultiModalFusionModel`: CNN+Transformer融合
- `BehaviorClassificationLoss`: 焦点损失函数

### 4. complete_training_pipeline.py
**功能**: 完整的端到端训练流水线
- ✅ 数据加载和预处理
- ✅ 多模态特征提取
- ✅ 多模型训练和评估
- ✅ 综合结果报告
- ✅ 早停和学习率调度

**关键类**:
- `TrainingPipeline`: 主训练流水线
- `MultiModalDataset`: 多模态数据集
- `EarlyStopping`: 早停机制

### 5. run_behavior_classification.py
**功能**: 一键运行脚本，简化使用流程
- ✅ 依赖检查
- ✅ 数据验证
- ✅ 多种运行模式
- ✅ 用户友好界面

## 🎯 系统特点

### 技术创新
1. **多模态融合**: STFT频域特征 + 时间序列特征
2. **自动标注**: 利用喉咙信号标注耳道数据
3. **深度学习**: CNN + Transformer + 注意力机制
4. **端到端**: 从原始数据到最终分类的完整流程

### 工程优化
1. **模块化设计**: 各功能独立，易于维护和扩展
2. **配置驱动**: JSON配置文件，参数化管理
3. **错误处理**: 完善的异常处理和用户提示
4. **可视化**: 丰富的图表和结果展示

### 用户体验
1. **一键运行**: 简单命令即可开始训练
2. **进度显示**: 详细的进度条和日志
3. **结果保存**: 自动保存模型和评估结果
4. **文档完善**: 详细的使用说明和示例

## 🔄 工作流程

### 完整流程
```
原始PPG&IMU数据 
    ↓
信号预处理 (滤波、去噪)
    ↓  
行为检测和标注 (基于喉咙信号)
    ↓
特征提取 (STFT + MFCC + 时间序列)
    ↓
数据分割和标准化
    ↓
深度学习训练 (CNN + Transformer + 融合)
    ↓
模型评估和选择
    ↓
结果可视化和报告生成
```

### 使用方式

#### 快速开始（推荐新手）
```bash
python run_behavior_classification.py --quick-start
```

#### 完整训练
```bash
python run_behavior_classification.py --full-pipeline --models fusion
```

#### 分步执行
```bash
# 1. 仅数据标注
python run_behavior_classification.py --data-only

# 2. 仅特征提取
python run_behavior_classification.py --feature-only

# 3. 完整训练
python complete_training_pipeline.py --config config_example.json
```

## 📊 预期结果

### 模型性能
- **验证准确率**: 85-92%
- **F1-Macro**: 0.82-0.90
- **各行为识别**: 静息>咳嗽>吞咽>咀嚼

### 输出文件
- 训练好的模型文件 (*.pth)
- 可视化结果图表 (*.png)
- 详细评估报告 (*.txt, *.csv)
- 标注数据集 (*.npz)

## 🔧 依赖环境

### Python包
```
torch >= 1.9.0
numpy >= 1.20.0
scipy >= 1.7.0
matplotlib >= 3.4.0
seaborn >= 0.11.0
scikit-learn >= 1.0.0
pandas >= 1.3.0
tqdm >= 4.60.0
```

### 硬件要求
- **CPU**: 多核处理器 (推荐8核以上)
- **内存**: 16GB+ (处理大量时间序列数据)
- **GPU**: NVIDIA GPU with CUDA (可选但推荐)
- **存储**: 10GB+ 可用空间

## 🚀 扩展方向

### 短期优化
1. **数据增强**: 时间扭曲、噪声注入等
2. **超参数优化**: 贝叶斯优化、网格搜索
3. **模型压缩**: 知识蒸馏、剪枝量化
4. **实时推理**: 流式处理优化

### 长期发展
1. **更多行为**: 说话、走路、跑步等
2. **跨用户泛化**: 个性化适应机制
3. **边缘部署**: 移动设备适配
4. **临床应用**: 医疗健康监测

## 📞 技术支持

### 常见问题
- 查看 `README_行为分类系统.md` 的常见问题部分
- 检查训练日志文件 `training.log`
- 验证数据格式和文件完整性

### 联系方式
- GitHub Issues: [项目仓库]
- 技术文档: `README_行为分类系统.md`
- 配置示例: `config_example.json`

---

**项目总结**: 这是一个完整的、工业级的深度学习项目，从数据预处理到模型部署的全流程覆盖。通过创新的多模态融合和自动标注技术，实现了基于耳道PPG&IMU信号的精准行为识别，为可穿戴健康监测设备提供了重要的技术基础。
