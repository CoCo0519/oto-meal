# PPG信号降噪GUI工具使用指南

## 🎉 问题已解决！

之前的错误已经修复。问题是在`ttk.Combobox`中使用了不支持的`command`参数，现在已经改为使用`bind('<<ComboboxSelected>>', callback)`方法。

## 🚀 快速开始

### 启动GUI工具

```bash
# 启动完整版GUI（推荐）
python ppg_denoising_gui.py

# 启动简化版GUI
python ppg_denoising_gui_simple.py
```

## 🎯 完整版GUI功能详解

### 1. 文件操作区域
- **Load Signal**: 加载PPG信号文件（.txt格式）
- **Save Denoised**: 保存降噪后的信号
- **Export Results**: 导出分析图表

### 2. 降噪方法选择
支持7种降噪方法，每种方法都有专门的参数控制：

#### Savitzky-Golay滤波
- **SG Window**: 窗口长度 (5-101)
- **SG Poly Order**: 多项式阶数 (1-5)
- **适用**: 平滑信号，保持峰值特征

#### 中值滤波
- **Median Kernel**: 核大小 (3-21)
- **适用**: 去除脉冲噪声

#### 维纳滤波
- **Wiener Noise**: 噪声方差 (0.01-1.0)
- **适用**: 已知噪声特性的信号

#### 小波近似 ⭐
- **Wavelet Cutoff**: 截止频率 (1-50 Hz)
- **Wavelet Order**: 滤波器阶数 (2-10)
- **适用**: 频域降噪

#### 带通滤波
- **Bandpass Low**: 低频 (0.1-5 Hz)
- **Bandpass High**: 高频 (1-10 Hz)
- **Bandpass Order**: 滤波器阶数 (2-8)
- **适用**: 心率信号提取

#### 自适应滤波
- **Adaptive Window**: 窗口大小 (5-50)
- **适用**: 时变噪声环境

#### 组合滤波
- **Method 1**: 选择第一种方法 (median, wiener, wavelet_approx)
- **Method 2**: 选择第二种方法 (savgol, bandpass, adaptive)
- **适用**: 复杂噪声环境

### 3. 显示选项
- **Show Original**: 显示原始信号
- **Show Denoised**: 显示降噪信号
- **Show Spectrum**: 显示STFT频谱图

### 4. 分析参数
- **STFT Window**: STFT窗口大小 (64-512)
- **STFT Overlap**: STFT重叠大小 (32-256)

### 5. 处理控制
- **Apply Denoising**: 应用降噪处理
- **Reset Signal**: 重置到原始信号

### 6. 性能指标
- **SNR**: 信噪比 (dB)
- **Std Dev Reduction**: 标准差减少量
- **Peak-to-Peak**: 峰峰值

## 🎨 界面布局说明

```
┌─────────────────────────────────────────────────────────┐
│                    PPG Signal Denoising Toolkit         │
├─────────────┬───────────────────────────────────────────┤
│ 文件操作    │                                           │
│ [Load Signal]│           时域信号显示                  │
│ [Save Denoised]│                                       │
│ [Export Results]│                                       │
├─────────────┤                                           │
│ 降噪方法    │                                           │
│ ○ Savitzky  │                                           │
│ ○ Median    │                                           │
│ ○ Wiener    │                                           │
│ ○ Wavelet   │ ← 您提到的小波近似方法                    │
│ ○ Bandpass  │                                           │
│ ○ Adaptive  │                                           │
│ ○ Combined  │                                           │
├─────────────┤                                           │
│ 参数控制    │                                           │
│ Wavelet Cutoff:│                                       │
│ [====●====] │ ← 实时调整截止频率                       │
│ Wavelet Order:│                                        │
│ [==●======] │ ← 实时调整滤波器阶数                     │
├─────────────┤                                           │
│ 显示选项    │                                           │
│ ☑ Original  │                                           │
│ ☑ Denoised │                                           │
│ ☐ Spectrum │                                           │
├─────────────┤                                           │
│ 性能指标    │                                           │
│ SNR: 15.2dB│ ← 实时显示信噪比                         │
│ Std Red: 0.8│ ← 实时显示标准差减少                     │
└─────────────┴───────────────────────────────────────────┘
```

## 🔧 使用步骤

### 步骤1: 加载信号
1. 点击 "Load Signal" 按钮
2. 选择PPG数据文件（.txt格式）
3. 系统会自动检测文件编码（UTF-8或GBK）

### 步骤2: 选择降噪方法
1. 在 "Denoising Method" 区域选择方法
2. 选择"小波近似"方法
3. 相应的参数控制面板会自动显示

### 步骤3: 调整参数
1. 使用"Wavelet Cutoff"滑块调整截止频率
2. 使用"Wavelet Order"滑块调整滤波器阶数
3. 参数调整后会自动应用降噪并显示结果

### 步骤4: 查看效果
1. 观察时域信号对比
2. 查看频域分析结果
3. 关注性能指标变化

### 步骤5: 保存结果
1. 点击"Save Denoised"保存降噪信号
2. 点击"Export Results"导出图表
3. 结果会自动保存到指定位置

## 📊 实时参数调整示例

### 小波近似方法参数调整

```
截止频率调整:
1.0 Hz  ←→  50.0 Hz
[====●====] ← 当前值: 12.5 Hz

滤波器阶数调整:
2  ←→  10
[==●======] ← 当前值: 6
```

### 实时效果反馈
- **参数变化**: 滑块移动时立即重新计算
- **效果显示**: 降噪信号实时更新
- **性能指标**: SNR和标准差减少实时更新

## 🎯 最佳实践

### 参数调优建议

1. **小波近似方法**:
   - 截止频率: 从12.5 Hz开始，根据信号特性调整
   - 滤波器阶数: 从6开始，阶数越高越平滑但可能过度滤波

2. **Savitzky-Golay方法**:
   - 窗口长度: 从51开始，奇数长度
   - 多项式阶数: 从3开始，阶数越高越灵活

3. **带通滤波方法**:
   - 低频: 0.8 Hz (心率下限)
   - 高频: 3.5 Hz (心率上限)

### 性能评估

- **SNR > 10 dB**: 降噪效果良好
- **SNR > 15 dB**: 降噪效果优秀
- **标准差减少 > 0.5**: 噪声显著减少

## 🔍 故障排除

### 常见问题

1. **GUI无法启动**
   - 确保Python环境正确
   - 检查tkinter是否可用

2. **信号加载失败**
   - 检查文件格式是否正确
   - 确认文件编码（UTF-8或GBK）

3. **降噪效果不佳**
   - 尝试不同的降噪方法
   - 调整参数范围
   - 检查信号质量

4. **性能问题**
   - 减少信号长度
   - 降低STFT窗口大小
   - 关闭不必要的显示选项

## 📈 高级功能

### 批量处理
```bash
# 使用原始脚本进行批量处理
python ppg_advanced_analysis.py --batch
```

### 降噪数据保存
- 降噪后的数据会自动保存到`ppg_denoised_data/`目录
- 按数据源组织结果文件
- 支持多种PPG通道处理

## 🎉 总结

现在您可以：

✅ **实时调整小波近似参数**: 截止频率和滤波器阶数
✅ **即时查看降噪效果**: 时域和频域对比
✅ **量化评估性能**: SNR和标准差减少指标
✅ **保存处理结果**: 降噪信号和图表导出
✅ **多种降噪方法**: 7种算法供选择

这个GUI工具完全实现了您要求的"可以通过图形化界面对'小波近似'等多个denoise方法进行动态调参实时展示结果以及denoise效果"的功能！
